from datetime import datetime
from IPython.display import clear_output
import os

ARQUIVO = "diario.txt"

def salvar_anotacao():
    """Salva uma nova anotaÃ§Ã£o com data e hora."""
    clear_output()
    print("ğŸ“ Nova AnotaÃ§Ã£o\n")
    texto = input("Digite sua anotaÃ§Ã£o:\n> ").strip()
    
    if texto:
        data_hora = datetime.now().strftime("%d/%m/%Y %H:%M:%S")
        try:
            with open(ARQUIVO, "a", encoding="utf-8") as f:
                f.write(f"[{data_hora}] {texto}\n")
            print("\nâœ… AnotaÃ§Ã£o salva com sucesso!")
        except Exception as e:
            print(f"âŒ Erro ao salvar a anotaÃ§Ã£o: {e}")
    else:
        print("âš ï¸ A anotaÃ§Ã£o estÃ¡ vazia!")

def mostrar_anotacoes(numeradas=False):
    """Exibe todas as anotaÃ§Ãµes salvas, com ou sem numeraÃ§Ã£o."""
    clear_output()
    print("ğŸ“š AnotaÃ§Ãµes Salvas\n")

    if not os.path.exists(ARQUIVO):
        print("ğŸ“˜ O diÃ¡rio ainda estÃ¡ vazio.")
        return []

    try:
        with open(ARQUIVO, "r", encoding="utf-8") as f:
            linhas = [linha.strip() for linha in f if linha.strip()]
        if not linhas:
            print("ğŸ“˜ O diÃ¡rio ainda estÃ¡ vazio.")
            return []
        
        print("-" * 40)
        for idx, linha in enumerate(linhas, 1):
            print(f"{idx}. {linha}" if numeradas else linha)
        print("-" * 40)
        return linhas
    except Exception as e:
        print(f"âŒ Erro ao ler as anotaÃ§Ãµes: {e}")
        return []

def excluir_anotacao():
    """Permite excluir uma anotaÃ§Ã£o especÃ­fica pelo nÃºmero."""
    linhas = mostrar_anotacoes(numeradas=True)
    if not linhas:
        return

    try:
        escolha = input("\nDigite o nÃºmero da anotaÃ§Ã£o a excluir (ou ENTER para cancelar): ").strip()
        if not escolha:
            print("â ExclusÃ£o cancelada.")
            return

        idx = int(escolha)
        if 1 <= idx <= len(linhas):
            anotacao_removida = linhas.pop(idx - 1)
            with open(ARQUIVO, "w", encoding="utf-8") as f:
                for linha in linhas:
                    f.write(linha + "\n")
            print(f"ğŸ—‘ï¸ AnotaÃ§Ã£o removida:\n> {anotacao_removida}")
        else:
            print("âŒ NÃºmero invÃ¡lido.")
    except ValueError:
        print("âŒ Entrada invÃ¡lida. Digite apenas o nÃºmero da anotaÃ§Ã£o.")
    except Exception as e:
        print(f"âŒ Erro ao excluir anotaÃ§Ã£o: {e}")

def menu():
    """Menu principal do diÃ¡rio eletrÃ´nico."""
    while True:
        print("\nğŸ“˜ DiÃ¡rio EletrÃ´nico")
        print("1. âœï¸ Escrever nova anotaÃ§Ã£o")
        print("2. ğŸ“– Ver anotaÃ§Ãµes")
        print("3. ğŸ—‘ï¸ Excluir uma anotaÃ§Ã£o")
        print("4. ğŸšª Sair")

        opcao = input("Escolha uma opÃ§Ã£o (1/2/3/4): ").strip()

        if opcao == "1":
            salvar_anotacao()
        elif opcao == "2":
            mostrar_anotacoes()
        elif opcao == "3":
            excluir_anotacao()
        elif opcao == "4":
            print("ğŸ‘‹ AtÃ© logo!")
            break
        else:
            clear_output()
            print("âŒ OpÃ§Ã£o invÃ¡lida. Tente novamente.")

# Executar o menu principal
if __name__ == "__main__":
    clear_output()
    menu()
